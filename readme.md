#  用C/C++制作一个简单的俄罗斯方块小游戏

<!-- [toc] -->
- [用C/C++制作一个简单的俄罗斯方块小游戏](#用cc制作一个简单的俄罗斯方块小游戏)
	- [0 准备](#0-准备)
	- [1 游戏界面设计](#1-游戏界面设计)
		- [1.1 界面布局](#11-界面布局)
		- [1.2 用 EasyX 显示界面](#12-用-easyx-显示界面)
	- [2 方块设计](#2-方块设计)
		- [2.1 方块显示](#21-方块显示)
	- [3 方块移动和旋转](#3-方块移动和旋转)
		- [3.1 方块的移动](#31-方块的移动)
		- [3.2 方块的旋转](#32-方块的旋转)
		- [3.3 方块的碰撞和消除](#33-方块的碰撞和消除)

## 0 准备

- 开发环境：Windows
- 编程语言：C/C++
- 开发软件：Visual Studio 2022 (软件安装可参考：链接: [Visual Studio 2022 免费版最新版本下载安装教程](https://blog.csdn.net/u011895157/article/details/128611019)
- 图形插件：EasyX

EasyX 的安装非常简单，百度搜索以下即可，**但是在安装前一定要先安装 Visual Studio**。下面的章节给出如何使用它。

## 1 游戏界面设计

### 1.1 界面布局

首先，我们要选择一章图片作为游戏的背景，我们可以在图片网站上下载合适的背景图片。

其次，在背景图片上划分出，游戏区和显示区，一般游戏区在正中间，两边为显示区。游戏区用于控制方块的移动、消除和变形等；显示区用于速度和分数的展示。下面是我设计的游戏界面：

![在这里插入图片描述](https://img-blog.csdnimg.cn/2ffba2436cdb4adc83f574fddd19690a.png)

用画图工具打开图片，可以看到背景大小为800*600像素，同时在图片中间设置游戏区（虚线框，大小自定义），添加速度和分数的文本框。

### 1.2 用 EasyX 显示界面

此时，我相信你应该建立了一个VS工程

## 2 方块设计

### 2.1 方块显示

方块可以由界面的横纵坐标表示，我们可以将下落的初始位置作为横坐标，方块的左边界作为纵坐标，方块每下落一格，表示行号+1，方块的表示如下图所示：

![方块显示](https://img-blog.csdnimg.cn/3a27b5eab42a49eb8da3e0c6f77c2a72.png)

## 3 方块移动和旋转

### 3.1 方块的移动
### 3.2 方块的旋转

![方块旋转](https://img-blog.csdnimg.cn/a7f487daf3d943ba8ef5e6ac71856b47.png)

如上图所示，这样可以用几行代码实现了方块的旋转，但是仍然需要注意下面的几个问题：

- 以什么为中心旋转？
- 方块是不断下落的，行和列是一直在变化的
- 在边界处有部分方块是不能变形的

针对第一个问题，如果想让方块的变形看起来不那么别捏，以4*4方格的中心变形是最合适的，即图中的2，3，4，5作为旋转的核心。

针对第二个问题，可以将方块的行列切换至初始位置，再进行上图的公式，然后再切回来，这边可以设置两个变量确定方块离初始位置的距离。

针对第三个问题，将方块的行列号暂存，进行变换，然后再进行检测是否有方块在边界外面，如果有，变形这步算作废。

变形的时候初始位置的确定也是非常关键的

![初始位置](https://img-blog.csdnimg.cn/f4cc7f9705514789adc0c4a0eac0a84f.png)

程序实现：

```c
void Graph::changeBlock()
{
	int temp[4][2] = { 0 };

	for (int i = 0; i < 4; i++)
	{
		//配合偏置，进行方块的旋转
		temp[i][0] = smallBlock[i][1] - colBasis;
		temp[i][1] = 3 - (smallBlock[i][0] - rowBasis);

		temp[i][0] += rowBasis;
		temp[i][1] += colBasis;

		//检查合法性
		if (temp[i][1] == 0 || temp[i][1] == cols - 1)
			return;
	}
	for (int i = 0; i < 4; i++)//若合法，实行
	{
		smallBlock[i][0] = temp[i][0];
		smallBlock[i][1] = temp[i][1];
	}
}
```

### 3.3 方块的碰撞和消除

方块的消除需要考虑下面几个问题

- 碰撞检测
- 一行的消除算法
  
碰撞检测很容易实现，由于左右移动我已经设置了边界检测，这边只需要对四个方块进行判断，也就是是说判断它们下面是否有方块就行。如果有，就返回 1

对一行的消除，采用一个二维数组对所有的位置进行记录，如果在（i，j）处有方块，则 `allBlock[i][j]=1`；在碰撞检测完毕之后，对整个数组进行遍历，如果一行

分数计算和等级提升：玩家的得分可以根据消除的行数计算得到，同时根据得分的高低可以判断玩家的等级，等级越高，方块下落的速度越快，难度越大。

游戏控制：玩家可以使用键盘或者手柄等设备控制方块的移动和旋转等操作。同时需要有暂停、重新开始、退出游戏等操作。

游戏音效和界面设计：游戏音效可以包括背景音乐、碰撞音效、消除音效等，同时游戏界面的设计也需要考虑美观性和易用性。

游戏存档和排行榜：可以将玩家的分数和等级等信息保存在本地或者服务器端，实现游戏存档和排行榜等功能